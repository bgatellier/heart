.build:
  stage: build
  script:
    - node common/scripts/install-run-rush.js build --verbose
  artifacts:
    paths:
      - common/temp/node_modules/
      - modules/
      - website/.firebaserc
      - website/firebase.json
      - website/dist/
      - rush.json
    expire_in: 1 hour

.test:
  stage: test
  extends:
    - .install

.coverage:
  extends:
    - .test
    - .only-master
  dependencies:
    - üèó Build for master
  coverage: /Branches\s+:\s\d+.?\d+/

.install:
  before_script:
    # required to use Puppeteer
    - apt-get -y update
    - apt-get -y install
      ca-certificates
      fonts-liberation
      libappindicator3-1
      libasound2
      libatk-bridge2.0-0
      libatk1.0-0
      libc6
      libcairo2
      libcups2
      libdbus-1-3
      libexpat1
      libfontconfig1
      libgbm1
      libgcc1
      libglib2.0-0
      libgtk-3-0
      libnspr4
      libnss3
      libpango-1.0-0
      libpangocairo-1.0-0
      libstdc++6
      libx11-6
      libx11-xcb1
      libxcb1
      libxcomposite1
      libxcursor1
      libxdamage1
      libxext6
      libxfixes3
      libxi6
      libxrandr2
      libxrender1
      libxss1
      libxtst6
      lsb-release
      wget
      xdg-utils
    # Update the rush.json repository url with the one used by the CI, to make the rush commands works
    - sed -i -e "s/$HOST_REPO_URL/$HOST_REPO_PIPELINE_URL/g" rush.json
    - node common/scripts/install-run-rush.js install
